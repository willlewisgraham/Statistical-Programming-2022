---
title: "Project 2"
author: "Will Graham; Richelle Lee; Robin Lin"
date: '2022-10-21'
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
Pone <- function(n = 20, k = 3, strategy = 1, nreps = 10000){
  # n: max # boxes to be opened; k: some prisoner's number; strategy: 1, 2, 3; nreps: # simulations.
  successes <- 0
  static_choices <- sample(1:(2*n), n, replace = FALSE)
  for (j in 1 : nreps){
    i <- 1
    cards <- sample(1 : (2 * n), 2 * n, replace = FALSE)
    next_box <- switch(strategy, k, sample(1:(2*n), 1), static_choices[i])
    while (i <= n){
      card <- cards[next_box]
      if (card != k){
        i <- i + 1
        next_box <- switch(strategy, card, card, static_choices[i])
      } else {
        successes <- successes + 1
        i <- n + 1
      }
    }
  }
  return (successes / nreps)  
}
```

```{r}
## Just to debug the above function, and you could delete this chunk afterwards.
debug(Pone)
Pone()
undebug(Pone)
```

```{r}
Pall <- function(n = 3, strategy = 1, nreps = 10){
  # n: max # boxes to be opened; strategy: 1, 2, 3; nreps: # simulations.
  successes <- 0
  for (j in 1 : nreps){
    if (strategy == 1){
      prisoners <- 1 : (2 * n)
      set.seed(sample(1 : 100, 1))
      cards <- sample(prisoners, 2 * n, replace = FALSE)
      i <- 1
      while (i <= n){
        prisoners_new <- prisoners[-which(cards == prisoners)]
        cards_new <- cards[-which(cards == prisoners)]
        prisoners <- prisoners_new
        cards <- cards_new
        if (length(prisoners) == 0){
          successes <- successes + 1
          break
        } else {
          prisoners_new[order(prisoners_new)[1 : length(prisoners_new)]] <- 1 : length(prisoners_new)
          cards_new[order(cards_new)[1 : length(cards_new)]] <- 1 : length(cards_new)
          prisoners[cards_new] <- prisoners_new[1 : length(prisoners_new)]
          cards <- cards_new
        }
        i = i + 1
      }
    }
    
    if (strategy == 2){
      set.seed(sample(1:100, 1))
      prisoners <- sample(1 : (2 * n), 2 * n, replace = FALSE)
      cards <- sample(prisoners, 2 * n, replace = FALSE)
      i <- 1
      while (i <= n){
        prisoners_new <- prisoners[-which(cards == prisoners)]
        cards_new <- cards[-which(cards == prisoners)]
        prisoners <- prisoners_new
        cards <- cards_new
        if (length(prisoners) == 0){
          successes <- successes + 1
          break
        } else {
          prisoners_new[order(prisoners_new)[1 : length(prisoners_new)]] <- 1 : length(prisoners_new)
          cards_new[order(cards_new)[1 : length(cards_new)]] <- 1 : length(cards_new)
          prisoners[cards_new] <- prisoners_new[1 : length(prisoners_new)]
          cards <- cards_new
        }
        i = i + 1
      }
    }
    
    ##if (strategy == 3){
      
    ##}
  }
  return (successes / nreps)
}
```

```{r}
Pall <- function(n = 3, strategy = 1, nreps = 10){
  # n: max # boxes to be opened; strategy: 1, 2, 3; nreps: # simulations.
  trial_successes <- 0
  for(i in 1 : nreps){
    set.seed(sample(1 : 100, 1))
    for (j in 1 : (2 * n)){
      if(Pone(n, j, strategy, 1) == 0){
        j <- j - 1
        break
      }
    }
    if (j == 2 * n){
      trial_successes <- trial_successes + 1
    }
  }
  return (trial_successes / nreps)
}

test <- 0
for (i in 1:1000){
  test = test + Pall()
}
```

```{r}
## Just to debug the above function, and you could delete this chunk afterwards.
debug(Pall)
Pall()
undebug(Pall)
```

```{r}
dloop <- function(n = 50, nreps = 10000){
  # n: max # boxes to be opened; nreps: # simulations.
  freq <- matrix(0, nreps, 2 * n)
  for (i in 1 : nreps){
    u <- sample(1 : (2 * n), 2 * n, replace = FALSE)
    cards <- u
    u <- u[u]
    matched_numbers <- rep(0, (2 *n))
    for (len_loop in 1 : (2 * n)){
      if( sum(u == cards & !( u %in%  matched_numbers)) > 0) {
        freq[i, len_loop] <- 1
      }
      current_matched_numbers <- u[u == cards]
      matched_numbers[current_matched_numbers] <- current_matched_numbers
      u <- cards[u]
    }
  }
  freq_new <- apply(freq, 2, sum)
  prob <- freq_new / nreps
  return(prob)
}
```

```{r}
## Just to debug the above function, and you could delete this chunk afterwards.
debug(dloop)
dloop()
undebug(dloop)
```
