---
title: "Project 2"
author: "Will Graham; Richelle Lee; Robin Lin"
date: '2022-10-21'
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
Pone <- function(n, k, strategy, nreps = 10000){
  # n: max # boxes to be opened; k: some prisoner's number; strategy: 1, 2, 3; nreps: # simulations.
  successes <- 0
  static_choices <- sample(1 : (2 * n), n, replace = FALSE)
  for (j in 1 : nreps){
    i <- 1
    cards <- sample(1 : (2 * n), 2 * n, replace = FALSE)
    next_box <- switch(strategy, k, sample(1 : (2 * n), 1), static_choices[i])
    while (i <= n){
      card <- cards[next_box]
      if (card != k){
        i <- i + 1
        next_box <- switch(strategy, card, card, static_choices[i])
      } else {
        successes <- successes + 1
        i <- n + 1
      }
    }
  }
  return (successes / nreps)  
}
```


```{r}
Pall <- function(n, strategy, nreps = 10000){
  trial_successes = 0
  for (i in  1 : nreps){
    static_choices <- matrix(0, 2 * n, n)
    for (k in 1 : (2 * n)){
      static_choices[k,] <- sample(1 : (2 * n), n, replace = FALSE)
    }
    prisoner_successes <- matrix(FALSE, n, 2* n)
    cards <- sample(1 : (2 * n), 2 * n, replace = FALSE)
    
    prisoner_current_card <- switch(strategy, cards, sample(1 : (2 * n), 2 * n, replace = FALSE), static_choices[,1])
    prisoner_successes[1,] <- prisoner_current_card == 1 : (2 * n)
    for (j in 2 : n){
      prisoner_current_card <- switch(strategy, cards[prisoner_current_card], cards[prisoner_current_card], static_choices[,j])
      prisoner_successes[j,] <- prisoner_current_card == 1 : (2 * n)
    }
    prisoner_results <- apply(prisoner_successes, 2, sum)
    if (!(0 %in% prisoner_results)){
      trial_successes <- trial_successes + 1
    } 
  }
  return(trial_successes / nreps)
}
```

```{r}
for (i in c(5, 50)){
  for (j in 1 : 3){
    cat("When n = ", i, " and strategy = ", j, ", the estimated probability of an individual prisoner finding their number is ", round(Pone(n = i, k = 1, strategy = j), 2),"\n", sep = "")
  }
}

for (i in c(5, 50)){
  for (j in 1 : 3){
    cat("When n = ", i, " and strategy = ", j, ", the estimated probability of all prisoners finding their numbers is ", round(Pall(n = i, strategy = j), 4),"\n", sep = "")
  }
}
```


```{r}
dloop <- function(n, nreps = 10000){
  # n: max # boxes to be opened; nreps: # simulations.
  freq <- matrix(0, nreps, 2 * n)
  for (i in 1 : nreps){
    u <- sample(1 : (2 * n), 2 * n, replace = FALSE)
    cards <- u
    u <- u[u]
    matched_numbers <- rep(0, (2 * n))
    for (len_loop in 1 : (2 * n)){
      if( sum(u == cards & !( u %in%  matched_numbers)) > 0) {
        freq[i, len_loop] <- 1
      }
      current_matched_numbers <- u[u == cards]
      matched_numbers[current_matched_numbers] <- current_matched_numbers
      u <- cards[u]
    }
  }
  freq_new <- apply(freq, 2, sum)
  prob <- freq_new / nreps
  return(prob)
}
```


```{r}
loop_len_prob <- dloop(50)
cat("For n = 50, the probability that there is no loop longer than 50 in a random reshuffling of cards to boxes is", (1 - round(sum(loop_len_prob[51 : 100]), 2)))

barplot(loop_len_prob, xlab = "Loop Length", ylab = "Probability of at least one occurrence", main = "Loop Length Probability Distribution", names.arg = c(1 : 100), col = c(rep("grey", 50), rep("red", 50)), sub = "Red bars represent the probability of observing at least one loop of length 50 or greater")
```

